<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    #nc-root {
      width: 100%;
      height: 100vh;
    }
    
    body {
      overflow-x: hidden;
    }
    
    /* Loading indicator */
    .cms-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-size: 18px;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="nc-root">
    <div class="cms-loading">Ładowanie CMS...</div>
  </div>
  
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <!-- Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.3.0/dist/decap-cms.js"></script>

  <script>
    // Polish translations for Decap CMS
    const plTranslations = {
      auth: {
        login: 'Zaloguj się',
        loggingIn: 'Logowanie...',
        loginWithNetlifyIdentity: 'Zaloguj się przez Netlify Identity',
        loginWithBitbucket: 'Zaloguj się przez Bitbucket',
        loginWithGitHub: 'Zaloguj się przez GitHub',
        loginWithGitLab: 'Zaloguj się przez GitLab',
        errors: {
          email: 'Wprowadź swój email.',
          password: 'Wprowadź swoje hasło.',
          identitySettings: 'Nie można uzyskać dostępu do ustawień tożsamości. Podczas korzystania z git-gateway backend upewnij się, że usługa Identity i Git Gateway są włączone w Netlify.'
        }
      },
      app: {
        header: {
          content: 'Treści',
          workflow: 'Przepływ pracy',
          media: 'Media',
          quickAdd: 'Szybkie dodawanie'
        },
        app: {
          errorHeader: 'Błąd podczas ładowania konfiguracji CMS',
          configErrors: 'Błędy konfiguracji',
          checkConfigYml: 'Sprawdź plik config.yml.',
          loadingConfig: 'Ładowanie konfiguracji...',
          waitingBackend: 'Oczekiwanie na backend...'
        },
        notFoundPage: {
          header: 'Nie znaleziono'
        }
      },
      collection: {
        sidebar: {
          collections: 'Kolekcje',
          allCollections: 'Wszystkie kolekcje'
        },
        collectionTop: {
          sortBy: 'Sortuj według',
          viewAs: 'Wyświetl jako',
          newButton: 'Nowy %{collectionLabel}'
        }
      },
      editor: {
        editorControl: {
          field: {
            optional: 'opcjonalne'
          }
        },
        editorControlPane: {
          widget: {
            required: '%{fieldLabel} jest wymagane.'
          }
        }
      },
      mediaLibrary: {
        mediaLibraryCard: {
          draft: 'Szkic'
        },
        mediaLibrary: {
          onDeleteTitle: 'Usunąć wybrane media?'
        }
      },
      ui: {
        default: {
          goBackToSite: 'Wróć do strony'
        },
        toast: {
          entrySaved: 'Wpis zapisany',
          entryPublished: 'Wpis opublikowany'
        }
      }
    };

    // Initialize CMS when ready
    function initCMS() {
      try {
        if (window.CMS) {
          // Remove loading indicator
          const loading = document.querySelector('.cms-loading');
          if (loading) {
            loading.remove();
          }
          
          // Register Polish locale
          CMS.registerLocale('pl', plTranslations);
          
          // Initialize CMS
          CMS.init();
          
          console.log('Decap CMS initialized successfully');
        } else {
          setTimeout(initCMS, 100);
        }
      } catch (error) {
        console.error('CMS initialization error:', error);
        setTimeout(initCMS, 1000);
      }
    }

    // Wait for DOM and start initialization
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initCMS);
    } else {
      initCMS();
    }

    // Netlify Identity configuration
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</body>
</html>