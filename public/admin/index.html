<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    #nc-root {
      width: 100%;
      height: 100vh;
    }
    
    body {
      overflow-x: hidden;
    }
    
    /* Loading indicator */
    .cms-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-size: 18px;
      color: #666;
    }
    
    /* Custom CMS Styling */
    .nc-collectionPage-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      border: none !important;
      border-radius: 12px !important;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1) !important;
      transition: all 0.3s ease !important;
      position: relative !important;
      overflow: hidden !important;
    }
    
    .nc-collectionPage-card:hover {
      transform: translateY(-5px) !important;
      box-shadow: 0 12px 40px rgba(0,0,0,0.15) !important;
    }
    
    .nc-collectionPage-card::before {
      content: '' !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent) !important;
      pointer-events: none !important;
    }
    
    /* Collection card titles with icons */
    .nc-collectionPage-card h2::before {
      font-family: 'Segoe UI Symbol', 'Segoe UI Emoji' !important;
      margin-right: 8px !important;
      font-size: 1.2em !important;
    }
    
    /* Specific icons for each collection */
    .nc-collectionPage-card h2[title*="Hero"]::before,
    .nc-collectionPage-card h2:contains("Strona G≈Ç√≥wna")::before {
      content: 'üè†' !important;
    }
    
    .nc-collectionPage-card h2[title*="About"]::before,
    .nc-collectionPage-card h2:contains("O mnie")::before {
      content: 'üë§' !important;
    }
    
    .nc-collectionPage-card h2[title*="Services"]::before,
    .nc-collectionPage-card h2:contains("Us≈Çugi")::before {
      content: 'üì∏' !important;
    }
    
    .nc-collectionPage-card h2[title*="Gallery"]::before,
    .nc-collectionPage-card h2:contains("Galeria")::before {
      content: 'üñºÔ∏è' !important;
    }
    
    .nc-collectionPage-card h2[title*="Contact"]::before,
    .nc-collectionPage-card h2:contains("Kontakt")::before {
      content: 'üìû' !important;
    }
    
    .nc-collectionPage-card h2[title*="Navigation"]::before,
    .nc-collectionPage-card h2:contains("Nawigacja")::before {
      content: 'üß≠' !important;
    }
    
    .nc-collectionPage-card h2[title*="Site"]::before,
    .nc-collectionPage-card h2:contains("Konfiguracja")::before {
      content: '‚öôÔ∏è' !important;
    }
    
    .nc-collectionPage-card h2[title*="Footer"]::before,
    .nc-collectionPage-card h2:contains("Stopka")::before {
      content: 'üìÑ' !important;
    }
    
    /* Card text styling */
    .nc-collectionPage-card h2 {
      color: white !important;
      font-weight: 600 !important;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3) !important;
    }
    
    .nc-collectionPage-card p {
      color: rgba(255,255,255,0.9) !important;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
    }
    
    /* Header styling */
    .nc-app-header {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1) !important;
    }
    
    /* Sidebar styling */
    .nc-app-aside {
      background: #f8fafc !important;
      border-right: 1px solid #e2e8f0 !important;
    }
    
    /* Button styling */
    .nc-button-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      border: none !important;
      border-radius: 8px !important;
      transition: all 0.3s ease !important;
    }
    
    .nc-button-primary:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4) !important;
    }
    
    /* Collection list styling */
    .nc-collectionPage-grid {
      gap: 20px !important;
      padding: 20px !important;
    }
    
    /* Media library styling */
    .nc-mediaLibrary-card {
      border-radius: 12px !important;
      overflow: hidden !important;
      transition: all 0.3s ease !important;
    }
    
    .nc-mediaLibrary-card:hover {
      transform: scale(1.02) !important;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }
  </style>
</head>
<body>
  <div id="nc-root">
    <div class="cms-loading">≈Åadowanie CMS...</div>
  </div>
  
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <!-- Decap CMS -->
  <script src="https://unpkg.com/decap-cms@3.1.10/dist/decap-cms.js"></script>

  <script>
    // Error handling for DOM manipulation issues
    const originalRemoveChild = Node.prototype.removeChild;
    const originalInsertBefore = Node.prototype.insertBefore;
    
    Node.prototype.removeChild = function(child) {
      try {
        if (this.contains(child)) {
          return originalRemoveChild.call(this, child);
        }
        return child;
      } catch (error) {
        console.warn('Suppressed removeChild error:', error.message);
        return child;
      }
    };
    
    Node.prototype.insertBefore = function(newNode, referenceNode) {
      try {
        return originalInsertBefore.call(this, newNode, referenceNode);
      } catch (error) {
        console.warn('Suppressed insertBefore error:', error.message);
        return this.appendChild(newNode);
      }
    };
    
    // Global error handler
    window.addEventListener('error', function(event) {
      if (event.error && event.error.message && 
          (event.error.message.includes('removeChild') || 
           event.error.message.includes('insertBefore') ||
           event.error.message.includes('NotFoundError'))) {
        console.warn('Suppressed DOM error:', event.error.message);
        event.preventDefault();
        return false;
      }
    });

    // Polish translations for Decap CMS
    const plTranslations = {
      auth: {
        login: 'Zaloguj siƒô',
        loggingIn: 'Logowanie...',
        loginWithNetlifyIdentity: 'Zaloguj siƒô przez Netlify Identity',
        loginWithBitbucket: 'Zaloguj siƒô przez Bitbucket',
        loginWithGitHub: 'Zaloguj siƒô przez GitHub',
        loginWithGitLab: 'Zaloguj siƒô przez GitLab',
        errors: {
          email: 'Wprowad≈∫ sw√≥j email.',
          password: 'Wprowad≈∫ swoje has≈Ço.',
          identitySettings: 'Nie mo≈ºna uzyskaƒá dostƒôpu do ustawie≈Ñ to≈ºsamo≈õci. Podczas korzystania z git-gateway backend upewnij siƒô, ≈ºe us≈Çuga Identity i Git Gateway sƒÖ w≈ÇƒÖczone w Netlify.'
        }
      },
      app: {
        header: {
          content: 'Tre≈õci',
          workflow: 'Przep≈Çyw pracy',
          media: 'Media',
          quickAdd: 'Szybkie dodawanie'
        },
        app: {
          errorHeader: 'B≈ÇƒÖd podczas ≈Çadowania konfiguracji CMS',
          configErrors: 'B≈Çƒôdy konfiguracji',
          checkConfigYml: 'Sprawd≈∫ plik config.yml.',
          loadingConfig: '≈Åadowanie konfiguracji...',
          waitingBackend: 'Oczekiwanie na backend...'
        },
        notFoundPage: {
          header: 'Nie znaleziono'
        }
      },
      collection: {
        sidebar: {
          collections: 'Kolekcje',
          allCollections: 'Wszystkie kolekcje'
        },
        collectionTop: {
          sortBy: 'Sortuj wed≈Çug',
          viewAs: 'Wy≈õwietl jako',
          newButton: 'Nowy %{collectionLabel}'
        }
      },
      editor: {
        editorControl: {
          field: {
            optional: 'opcjonalne'
          }
        },
        editorControlPane: {
          widget: {
            required: '%{fieldLabel} jest wymagane.'
          }
        }
      },
      mediaLibrary: {
        mediaLibraryCard: {
          draft: 'Szkic'
        },
        mediaLibrary: {
          onDeleteTitle: 'UsunƒÖƒá wybrane media?'
        }
      },
      ui: {
        default: {
          goBackToSite: 'Wr√≥ƒá do strony'
        },
        toast: {
          entrySaved: 'Wpis zapisany',
          entryPublished: 'Wpis opublikowany'
        }
      }
    };

    // Anti-duplication system
    function setupAntiDuplication() {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList') {
            // Remove duplicate CMS containers
            const containers = document.querySelectorAll('[data-netlify-cms], .cms-editor-visual, .nc-app-container');
            if (containers.length > 1) {
              for (let i = 1; i < containers.length; i++) {
                containers[i].remove();
                console.log('Removed duplicate CMS container');
              }
            }
            
            // Remove duplicate navigation elements
            const navs = document.querySelectorAll('nav[role="navigation"]');
            if (navs.length > 1) {
              for (let i = 1; i < navs.length; i++) {
                navs[i].remove();
                console.log('Removed duplicate navigation');
              }
            }
          }
        });
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
      
      return observer;
    }

    // Initialize CMS when ready
    function initCMS() {
      try {
        if (window.CMS) {
          // Remove loading indicator
          const loading = document.querySelector('.cms-loading');
          if (loading) {
            loading.remove();
          }
          
          // Setup anti-duplication before CMS init
          setupAntiDuplication();
          
          // Register Polish locale
          CMS.registerLocale('pl', plTranslations);
          
          // Initialize CMS
          CMS.init();
          
          console.log('Decap CMS initialized successfully with anti-duplication');
          
          // Apply custom styling and icons
          setTimeout(applyCustomStyling, 1000);
        } else {
          setTimeout(initCMS, 100);
        }
      } catch (error) {
        console.error('CMS initialization error:', error);
        setTimeout(initCMS, 1000);
      }
    }

    // Custom styling function
    function applyCustomStyling() {
      const cardTitles = document.querySelectorAll('.nc-collectionPage-card h2, [class*="collection"] h2, [class*="card"] h2');
      
      cardTitles.forEach(title => {
        const text = title.textContent.toLowerCase();
        let icon = '';
        
        if (text.includes('hero') || text.includes('strona g≈Ç√≥wna') || text.includes('strona glowna')) {
          icon = 'üè†';
        } else if (text.includes('about') || text.includes('o mnie')) {
          icon = 'üë§';
        } else if (text.includes('services') || text.includes('us≈Çugi') || text.includes('uslugi')) {
          icon = 'üì∏';
        } else if (text.includes('gallery') || text.includes('galeria')) {
          icon = 'üñºÔ∏è';
        } else if (text.includes('contact') || text.includes('kontakt')) {
          icon = 'üìû';
        } else if (text.includes('navigation') || text.includes('nawigacja')) {
          icon = 'üß≠';
        } else if (text.includes('site') || text.includes('konfiguracja') || text.includes('config')) {
          icon = '‚öôÔ∏è';
        } else if (text.includes('footer') || text.includes('stopka')) {
          icon = 'üìÑ';
        }
        
        if (icon && !title.textContent.startsWith(icon)) {
          title.textContent = icon + ' ' + title.textContent;
        }
      });
      
      // Re-apply styling periodically for dynamic content
      setTimeout(applyCustomStyling, 3000);
    }

    // Wait for DOM and start initialization
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initCMS);
    } else {
      initCMS();
    }

    // Netlify Identity configuration
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</body>
</html>